"0","# This function allows us to replace the dataframe containing the marker cell counts, and the title. Be sure to add the stats info. See example in ### Call function"
"0","create_barplot <- function(data_summ, "
"0","                           data_marker, "
"0","                           treatment_col = ""treatment"","
"0","                           marker_col = ""marker"", "
"0","                           title = ""Title"", "
"0","                           positions = c(""pcig"", ""dnrbpj""),"
"0","                           test_used = ""stats test"","
"0","                           p_value = NA) {"
"0","  "
"0","  scaleFUN <- function(x) sprintf(""%.1f"", x) # Function to format y-axis"
"0","  "
"0","  # Creating the plot"
"0","  barplot <- ggplot(data_summ, "
"0","                          aes(x = !!sym(treatment_col), "
"0","                              y = mean_cells)) + "
"0","    geom_col(width = 0.5, "
"0","             aes(fill = !!sym(treatment_col)), "
"0","             color = 'black', "
"0","             size = 0.5) + "
"0","    geom_errorbar(aes(ymin = mean_cells - SE_cells, "
"0","                      ymax = mean_cells + SE_cells), "
"0","                  width = 0.3, "
"0","                  size = 0.5) + "
"0","    geom_dotplot(data = data_marker, "
"0","                 aes(x = !!sym(treatment_col), "
"0","                     y = !!sym(marker_col), "
"0","                     fill = !!sym(treatment_col)), "
"0","                 binaxis = 'y', "
"0","                 stackdir = 'center', "
"0","                 dotsize = 0.8, "
"0","                 show.legend = FALSE) + "
"0","    theme_classic(base_size = 12) + "
"0","    ylab(""% of GFP+ cells"") + "
"0","    scale_x_discrete(limits = positions) + "
"0","    theme("
"0","      panel.background = element_blank(),"
"0","      plot.background = element_blank(),"
"0","      axis.line = element_line(size = 0.5, "
"0","                               color = rgb(0, 0, 0, max = 255)), "
"0","      axis.text.x = element_text(colour = 'black', angle = 45, hjust = 1), "
"0","      axis.text.y = element_text(hjust = 1, colour = 'black'), "
"0","      axis.title.x = element_blank(), "
"0","      aspect.ratio = 2 / 1, "
"0","      legend.key.size = unit(0.7, ""line""), "
"0","      text = element_text(size = 14), "
"0","      plot.title = element_text(size = 14)) + "
"0","    scale_y_continuous(expand = c(0, 0), labels = scaleFUN) + "
"0","    scale_fill_manual(values = c('gray', 'white'), "
"0","                      name = """", "
"0","                      labels = c(""pcig"", ""dnrbpj"")) + "
"0","    ggtitle(title) + "
"0","    theme(legend.position = ""none"") + "
"0","    annotate(""text"", x = 1.5, y = max(data_summ$mean_cells) + 0.5, "
"0","             label = paste(test_used, ""\np-value ="", format(p_value, digits = 3)), "
"0","             size = 2, hjust = 0.5)"
"0","  "
"0","  return(barplot)"
"0","}"
